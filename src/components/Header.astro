---
// Header.astro - Con funcionalidad de scroll a secciones mejorada

// (Eliminada la importación de Services)

const navItems = [
  { label: 'Services', href: '#services', scrollAdjust: -80 },
  { label: 'Values', href: '#values', scrollAdjust: -80 },
  { label: 'Projects', href: '#projects', scrollAdjust: -130 },
  { label: 'About Us', href: '#about', scrollAdjust: -80 },
  { label: 'Awards', href: '#awards', scrollAdjust: -80 },
  
];

// Añadir clase activa para la página actual
const currentPath = Astro.url.pathname;
---

<header class="fixed w-full z-50 transition-all duration-300 bg-white/95 backdrop-blur-md" id="main-header">
  <div class="mx-auto px-4 sm:px-6 md:px-10 py-3 sm:py-4 md:py-5">
    <div class="flex items-center justify-between">
      <a href="#home" class="flex items-center z-10 logo-link">
        <img
          src="/full_logo.png"
          alt="OSIX Logo"
          class="h-6 sm:h-7 md:h-8 w-auto transition-transform duration-200"
          id="logo-img"
        />
      </a>
      
      <!-- Navegación principal - Versión desktop -->
      <nav class="hidden md:flex items-center justify-center flex-1">
        <div class="relative flex items-center space-x-1">
          {navItems.map((item, index) => {
            return (
              <a
                href={item.href}
                class="relative px-4 sm:px-5 py-2 sm:py-3 text-sm sm:text-base font-medium transition-all duration-300 rounded-full hover:bg-black/5 nav-item"
                data-index={index}
                data-scroll-adjust={item.scrollAdjust}
              >
                {item.label}
              </a>
            );
          })}
          <div id="nav-indicator" class="absolute bottom-0 h-0.5 bg-black rounded-full transition-all duration-300 pointer-events-none opacity-0"></div>
        </div>
      </nav>
      
      <!-- CTA button -->
      <div class="hidden md:block">
        <a href="#contact" class="inline-flex items-center justify-center h-9 sm:h-10 px-4 sm:px-5 py-0 text-sm font-medium bg-black text-white transition-all duration-300 rounded-md hover:shadow-lg hover:shadow-black/20 hover:scale-105" data-scroll-adjust="-80">
          <span>Contact</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 ml-2 -mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
          </svg>
        </a>
      </div>

      <!-- Menú móvil -->
      <button id="mobile-toggle" class="md:hidden flex items-center justify-center w-10 h-10 focus:outline-none z-10" aria-label="Menú" aria-expanded="false">
        <div class="burger-icon">
          <span class="burger-line"></span>
          <span class="burger-line"></span>
        </div>
      </button>
    </div>
  </div>
  
  <!-- Menú móvil overlay -->
  <div id="mobile-menu" class="fixed inset-0 bg-white flex flex-col justify-center items-center opacity-0 pointer-events-none transition-all duration-500 z-40" aria-hidden="true">
    <nav class="flex flex-col items-center space-y-4 sm:space-y-6 px-4 sm:px-6 w-full">
      {navItems.map((item, index) => {
        return (
          <a
            href={item.href}
            class="text-xl sm:text-2xl font-medium transition-all duration-300 py-2 mobile-nav-item text-gray-600 hover:text-black"
            data-scroll-adjust={item.scrollAdjust}
            style={`--index: ${index}`}
          >
            {item.label}
          </a>
        );
      })}
      
      <div class="pt-6 sm:pt-8 w-full max-w-xs">
        <a href="#contact" class="flex items-center justify-center w-full px-4 sm:px-6 py-3 sm:py-4 text-base font-medium bg-black text-white transition-all duration-300 rounded-full mt-2 hover:opacity-90">
          Contact
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
          </svg>
        </a>
      </div>
    </nav>
    
    <div class="absolute bottom-6 sm:bottom-10 left-0 w-full px-4 sm:px-6">
      <div class="flex flex-col items-center justify-center space-y-3 sm:space-y-4">
        <div class="flex space-x-4">
          <a href="#" class="text-gray-500 hover:text-black transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 16h-2v-6h2v6zm-1-6.891c-.607 0-1.1-.496-1.1-1.109 0-.612.492-1.109 1.1-1.109s1.1.497 1.1 1.109c0 .613-.493 1.109-1.1 1.109zm8 6.891h-1.998v-2.861c0-1.881-2.002-1.722-2.002 0v2.861h-2v-6h2v1.093c.872-1.616 4-1.736 4 1.548v3.359z"/>
            </svg>
          </a>
          <a href="#" class="text-gray-500 hover:text-black transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/>
            </svg>
          </a>
          <a href="#" class="text-gray-500 hover:text-black transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-4.5 16.5v-9.375h-1.875v9.375h1.875zm-.938-10.688c.604 0 1.13-.393 1.13-.984s-.526-.985-1.13-.985c-.63 0-1.162.393-1.162.985 0 .591.532.984 1.162.984zm8.663 10.688v-5.325c0-1.771-.931-2.625-2.18-2.625-1.037 0-1.704.615-1.987 1.205v-1.005h-1.993v7.75h1.976v-4.492c0-.719.543-1.289 1.259-1.289.699 0 1.025.521 1.025 1.289v4.492h1.9z"/>
            </svg>
          </a>
        </div>
        <div class="text-gray-400 text-xs sm:text-sm">© 2025 YourCompany</div>
      </div>
    </div>
  </div>

  <!-- (Eliminado Services) -->
</header>

<script>
  // Script para manejar la navegación interactiva
  document.addEventListener('DOMContentLoaded', () => {
    const header = document.getElementById('main-header');
    const navItems = document.querySelectorAll('.nav-item');
    const navIndicator = document.getElementById('nav-indicator');
    const mobileToggle = document.getElementById('mobile-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const burgerIcon = document.querySelector('.burger-icon');
    const allNavLinks = document.querySelectorAll('nav .nav-item');
    const logoLink = document.querySelector('.logo-link');
    let isMenuOpen = false;
    let activeNavItem: HTMLElement | null = null;
    let disableIndicatorUpdate = false;
    
    // Función para actualizar el indicador de navegación
    function updateIndicatorBySection(sectionId: string) {
      navItems.forEach(item => {
        item.classList.remove('nav-active');
      });
      
      if (sectionId === 'home') {
        if (navIndicator) {
          navIndicator.style.opacity = '0';
        }
        activeNavItem = null;
        return;
      }
      
      const targetNavItem = document.querySelector(`nav .nav-item[href="#${sectionId}"]`) as HTMLElement;
      if (targetNavItem) {
        targetNavItem.classList.add('nav-active');
        activeNavItem = targetNavItem;
        
        if (navIndicator) {
          navIndicator.style.width = `${targetNavItem.offsetWidth - 20}px`;
          navIndicator.style.left = `${targetNavItem.offsetLeft + 10}px`;
          navIndicator.style.opacity = '1';
        }
      }
    }
    
    // Hover en elementos del menú
    navItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        if (!isMenuOpen && navIndicator) {
          navIndicator.style.width = `${(item as HTMLElement).offsetWidth - 20}px`;
          navIndicator.style.left = `${(item as HTMLElement).offsetLeft + 10}px`;
          navIndicator.style.opacity = '1';
          item.classList.add('nav-hover');
        }
      });
      
      item.addEventListener('mouseleave', () => {
        if (!isMenuOpen && navIndicator) {
          item.classList.remove('nav-hover');
          
          if (activeNavItem) {
            navIndicator.style.width = `${activeNavItem.offsetWidth - 20}px`;
            navIndicator.style.left = `${activeNavItem.offsetLeft + 10}px`;
            navIndicator.style.opacity = '1';
          } else {
            navIndicator.style.opacity = '0';
          }
        }
      });
    });
    
    // Scroll suave a secciones
    allNavLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        
        if (isMenuOpen) toggleMobileMenu();
        
        const targetId = link.getAttribute('href');
        if (!targetId) return;
        
        const targetIdClean = targetId.substring(1);
        disableIndicatorUpdate = true;
        
        navItems.forEach(item => {
          item.classList.remove('nav-active');
          if (item.getAttribute('href') === targetId) {
            item.classList.add('nav-active');
            if (navIndicator) {
              navIndicator.style.width = `${(item as HTMLElement).offsetWidth - 20}px`;
              navIndicator.style.left = `${(item as HTMLElement).offsetLeft + 10}px`;
              navIndicator.style.opacity = '1';
              activeNavItem = item as HTMLElement;
            }
          }
        });
        
        if (targetIdClean === 'home') {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        } else {
          const targetSection = document.querySelector(targetId);
          if (targetSection && header) {
            const adjustAttr = link.getAttribute('data-scroll-adjust');
            const customAdjust = adjustAttr ? parseInt(adjustAttr) : 0;
            const headerHeight = header.offsetHeight;
            const targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset - headerHeight - customAdjust;
            
            window.scrollTo({
              top: targetPosition,
              behavior: 'smooth'
            });
          }
        }
        
        setTimeout(() => {
          disableIndicatorUpdate = false;
        }, 700);
      });
    });
    
    // Activar enlaces según la sección visible
    function setActiveNavItem() {
      if (disableIndicatorUpdate || !header) return;

      const sections = document.querySelectorAll('section[id]');
      let scrollPosition = window.scrollY + header.offsetHeight + 100;
      
      sections.forEach(section => {
        const sectionTop = (section as HTMLElement).offsetTop;
        const sectionHeight = (section as HTMLElement).offsetHeight;
        const sectionId = section.getAttribute('id');
        
        if (sectionId && scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
          updateIndicatorBySection(sectionId);
        }
      });
      
      if (scrollPosition < 100 + header.offsetHeight) {
        updateIndicatorBySection('home');
      }
    }
    
    // Efectos de scroll
    function handleScroll() {
      if (!header) return;
      
      if (window.scrollY > 20) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
      
      setActiveNavItem();
    }
    
    // Toggle del menú móvil
    function toggleMobileMenu() {
      if (!mobileMenu || !mobileToggle || !burgerIcon) return;
      
      isMenuOpen = !isMenuOpen;
      mobileMenu.setAttribute('aria-hidden', String(!isMenuOpen));
      mobileToggle.setAttribute('aria-expanded', String(isMenuOpen));
      
      if (isMenuOpen) {
        mobileMenu.classList.add('opacity-100', 'pointer-events-auto');
        mobileMenu.classList.remove('opacity-0', 'pointer-events-none');
        document.body.classList.add('overflow-hidden');
      } else {
        mobileMenu.classList.remove('opacity-100', 'pointer-events-auto');
        mobileMenu.classList.add('opacity-0', 'pointer-events-none');
        document.body.classList.remove('overflow-hidden');
      }
    }
    
    if (mobileToggle) {
      mobileToggle.addEventListener('click', toggleMobileMenu);
    }
    
    // Cerrar menú al hacer clic en un enlace
    const mobileLinks = mobileMenu?.querySelectorAll('a');
    mobileLinks?.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        
        if (isMenuOpen) toggleMobileMenu();
        
        const targetId = link.getAttribute('href');
        if (!targetId || !header) return;
        
        const targetIdClean = targetId.substring(1);
        const adjustAttr = link.getAttribute('data-scroll-adjust');
        const customAdjust = adjustAttr ? parseInt(adjustAttr) : 0;
        
        if (targetIdClean === 'home') {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        } else {
          const targetSection = document.querySelector(targetId);
          if (targetSection) {
            const headerHeight = header.offsetHeight;
            const targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset - headerHeight - customAdjust;
            
            window.scrollTo({
              top: targetPosition,
              behavior: 'smooth'
            });
          }
        }
      });
    });
    
    // Event listeners
    window.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', () => {
      if (activeNavItem && navIndicator) {
        navIndicator.style.width = `${activeNavItem.offsetWidth - 20}px`;
        navIndicator.style.left = `${activeNavItem.offsetLeft + 10}px`;
      }
    });
    
    // Inicialización
    handleScroll();
    
    if (logoLink) {
      logoLink.addEventListener('click', (e) => {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }
  });
</script>

<style>
  #main-header {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-weight: 500;
  }
  
  /* Estilos para la navegación limpia */
  .scrolled {
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }
  
  /* Estilos para elementos de navegación */
  .nav-item {
    color: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    letter-spacing: 0.01em;
    position: relative;
    transition: color 0.3s ease;
  }
  
  .nav-item:hover {
    color: rgba(0, 0, 0, 0.9);
  }
  
  /* Estilo para item activo */
  .nav-active {
    color: #000;
    font-weight: 500;
  }
  
  /* Mejorar la transición del indicador */
  #nav-indicator {
    transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
    z-index: 1;
  }
  
  /* Efecto hover en el logo */
  .logo-link {
    transition: transform 0.3s ease;
  }
  
  .logo-link:hover {
    transform: scale(1.05);
  }
  
  /* Estilos para el botón hamburguesa */
  .burger-icon {
    position: relative;
    width: 24px;
    height: 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  
  .burger-line {
    width: 100%;
    height: 2px;
    background-color: black;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center;
  }
  
  #mobile-toggle[aria-expanded="true"] .burger-line:first-child {
    transform: translateY(8px) rotate(45deg);
  }
  
  #mobile-toggle[aria-expanded="true"] .burger-line:last-child {
    transform: translateY(-8px) rotate(-45deg);
  }
  
  #mobile-menu[aria-hidden="false"] {
    opacity: 1;
    pointer-events: auto;
  }
  
  /* Animación de entrada para el menú móvil */
  @keyframes fadeUpIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  #mobile-menu nav a {
    animation: fadeUpIn 0.5s ease forwards;
    animation-delay: calc(0.1s * var(--index, 0));
    opacity: 0;
  }
  
  #mobile-menu.opacity-100 {
    transition-timing-function: cubic-bezier(0.22, 1, 0.36, 1);
  }
  
  /* Mejora en animaciones de elementos del menu móvil */
  .mobile-nav-item {
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transition-delay: calc(0.1s * var(--index, 0));
    opacity: 0;
    transform: translateY(10px);
  }
  
  #mobile-menu.opacity-100 .mobile-nav-item {
    opacity: 1;
    transform: translateY(0);
  }
  
  .mobile-nav-item::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    width: 0;
    height: 1px;
    background-color: #000;
    transition: all 0.3s ease;
    transform: translateX(-50%);
  }
  
  .mobile-nav-item:hover::after {
    width: 30px;
  }
  
  /* Mejoras en el menú móvil */
  #mobile-menu {
    transform: translateY(-20px);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  #mobile-menu.opacity-100 {
    transform: translateY(0);
  }

  /* Mejoras de accesibilidad */
  @media (max-width: 768px) {
    .nav-item {
      padding: 0.75rem 1rem;
    }
    
    #mobile-menu {
      transform: translateY(-20px);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    #mobile-menu[aria-hidden="false"] {
      transform: translateY(0);
    }
  }
</style>